define("wasabi.cms.package/views/Routes",["require","common/BaseView"],function(e){var t=e("common/BaseView");return t.extend({el:'[class*="wasabi-cms--pages-"] .field.routes',events:{'click .new-route button[type="submit"]':"onNewRouteSubmit",deleteRoute:"unblockUpdate",makeDefaultRoute:"unblockUpdate"},dataModel:null,pageId:null,elem:null,routeEndpoint:null,initialize:function(){this.pageId=$("#page-id").val();var e=this.$el.find("table.routes");this.routeEndpoint=e.attr("data-add-route-url"),this.dataModel=e.attr("data-model"),this.elem=e.attr("data-element"),$("#CmsPageEditForm").on("submit",_.bind(function(e){var t=$(e.originalEvent.explicitOriginalTarget).attr("id");("routes-url"===t||"routes-type"===t)&&(e.preventDefault(),this.submitRoute())},this))},onNewRouteSubmit:function(e){e.preventDefault(),this.submitRoute()},block:function(){this.blockThis({backgroundColor:"#fff"})},unblockUpdate:function(e,t){this.unblockThis(),t.content&&this.$el.html(t.content)},submitRoute:function(){this.block(null),$.ajax({type:"post",url:this.routeEndpoint,data:{url:this.$el.find("#routes-url").val(),route_type:this.$el.find("#routes-type").val(),model:this.dataModel,foreign_key:this.pageId,element:this.elem},dataType:"json",success:_.bind(function(e){this.unblockUpdate(null,e)},this)})}})}),define("wasabi.cms.package/models/Grid",["require","backbone"],function(e){var t=e("backbone"),i=t.Model.extend({modelName:"Grid",defaults:{colWidth:1,baseWidth:16}});return i}),define("wasabi.cms.package/models/Meta",["require","backbone","wasabi.cms.package/models/Grid"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/models/Grid"),o=t.Model.extend({modelName:"Meta",defaults:{type:""},initialize:function(e){return this.set("type",e.type),"undefined"!=typeof e.grid&&this.set("grid",new i({colWidth:e.grid.colWidth,baseWidth:e.grid.baseWidth})),this},getData:function(){var e=this.get("grid"),t=this.toJSON();return e&&(t.grid=e.toJSON()),t}});return o}),define("wasabi.cms.package/components/page-builder/models/Module",["require","backbone","wasabi.cms.package/models/Meta"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/models/Meta"),o=t.Model.extend({modelName:"Module",initialize:function(){return this.set("meta",new i(this.get("meta")),{silent:!0}),this},getData:function(){return{meta:this.get("meta").toJSON()}}});return o}),define("wasabi.cms.package/components/page-builder/collections/Modules",["require","backbone","wasabi.cms.package/components/page-builder/models/Module"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/models/Module"),o=t.Collection.extend({collectionType:"ModulesCollection",model:i});return o}),define("wasabi.cms.package/components/page-builder/models/Cell",["require","backbone","wasabi.cms.package/components/page-builder/collections/Modules","wasabi.cms.package/models/Meta"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/collections/Modules"),o=e("wasabi.cms.package/models/Meta"),a=t.Model.extend({modelName:"Cell",initialize:function(){var e=this.get("data");return e&&(this.modules=new i(e),this.unset("data")),this.set("meta",new o(this.get("meta")),{silent:!0}),this},getData:function(){var e={meta:this.get("meta").toJSON(),data:[]};return this.modules.each(function(t){e.data.push(t.getData())}),e}});return a}),define("wasabi.cms.package/components/page-builder/collections/Cells",["require","backbone","wasabi.cms.package/components/page-builder/models/Cell"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/models/Cell"),o=t.Collection.extend({collectionType:"CellsCollection",model:i});return o}),define("wasabi.cms.package/components/page-builder/models/Row",["require","backbone","wasabi.cms.package/components/page-builder/collections/Cells","wasabi.cms.package/models/Meta"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/collections/Cells"),o=e("wasabi.cms.package/models/Meta"),a=t.Model.extend({modelName:"Row",initialize:function(){var e=this.get("data");return e&&(this.cells=new i(e),this.unset("data")),this.set("meta",new o(this.get("meta")),{silent:!0}),this},getData:function(){var e={meta:this.get("meta").toJSON(),data:[]};return this.cells.each(function(t){e.data.push(t.getData())}),e}});return a}),define("wasabi.cms.package/components/page-builder/collections/Content",["require","backbone","wasabi.cms.package/components/page-builder/models/Row","wasabi.cms.package/components/page-builder/models/Module"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/models/Row"),o=e("wasabi.cms.package/components/page-builder/models/Module"),a=t.Collection.extend({collectionType:"ContentCollection",model:function(e,a){switch(e.meta.type){case"Row":return new i(e,a);case"Module":return new o(e,a);default:return new t.Model(e,a)}},addRow:function(e){this.add(new i(e))}});return a}),define("wasabi.cms.package/components/page-builder/models/ContentArea",["require","backbone","wasabi.cms.package/components/page-builder/collections/Content","wasabi.cms.package/models/Meta"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/collections/Content"),o=e("wasabi.cms.package/models/Meta"),a=t.Model.extend({modelName:"ContentArea",initialize:function(){var e=this.get("data");return e&&(this.content=new i(e),this.unset("data")),this.set("meta",new o(this.get("meta")),{silent:!0}),this},getData:function(){var e={meta:this.get("meta").toJSON(),data:[]};return this.content.each(function(t){e.data.push(t.getData())}),e}});return a}),define("wasabi.cms.package/components/page-builder/collections/ContentAreas",["require","backbone","wasabi.cms.package/components/page-builder/models/ContentArea"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/page-builder/models/ContentArea"),o=t.Collection.extend({collectionType:"ContentAreasCollection",model:i});return o}),define("wasabi.cms.package/components/page-builder/models/PageBuilder",["require","underscore","backbone","wasabi.cms.package/components/page-builder/collections/ContentAreas"],function(e){var t=(e("underscore"),e("backbone")),i=e("wasabi.cms.package/components/page-builder/collections/ContentAreas"),o=t.Model.extend({modelName:"PageBuilder",initialize:function(){var e=this.get("content");return e&&(this.contentAreas=new i(e),this.unset("content")),this},loadFormData:function(){},rebuildContentData:function(){var e=[];this.contentAreas.each(function(t){e.push(t.getData())}),this.set("data",e)}});return o}),define("common/DialogView",["require","jquery","underscore","common/BaseView"],function(e){var t=e("jquery"),i=e("underscore"),o=e("common/BaseView");return o.extend({templateData:{},$sidebarLeft:{},$sidebarRight:{},$content:{},events:{'click [data-toggle="close"]':"closeDialog"},initialize:function(){this.template=i.template(t("#wasabi-core-dialog").html())},render:function(){"function"==typeof this.beforeRender&&this.beforeRender(),this.templateData.sidebarLeft||(this.templateData.sidebarLeft=!1),this.templateData.sidebarRight||(this.templateData.sidebarRight=!1),this.setElement(this.template(this.templateData)),t("body").addClass("dialog-open").append(this.$el),t(window).on("keyup",i.bind(this.onKeyup,this)),this.$sidebarLeft=this.$("dialog-sidebar-left"),this.$sidebarRight=this.$("dialog-sidebar-right"),this.$content=this.$(".dialog-content"),"function"==typeof this.initDialogContent&&this.initDialogContent()},closeDialog:function(){t(window).off("keyup",i.bind(this.onKeyup,this)),this.destroy(),t("body").removeClass("dialog-open")},onKeyup:function(e){27===e.which&&this.closeDialog()}})}),define("wasabi.cms.package/components/row-dialog/views/CellEditor",["require","jquery","common/BaseView","marionette"],function(e){var t=e("jquery"),i=(e("common/BaseView"),e("marionette")),o=i.ItemView.extend({tagName:"div",template:"#pb-cell-editor",events:{"mousedown .resize-handle":"onMouseDown","click .cell-remove":"removeCell","click .cell-wrapper":"selectCell"},modelEvents:{"change:selected":"selectedChanged"},onRender:function(){var e=this.model.get("meta").get("grid");this.gridClass&&this.$el.removeClass(this.gridClass),this.gridClass="grid-"+e.get("colWidth")+"-"+e.get("baseWidth"),this.$el.addClass(this.gridClass),this.$el.attr("data-type","cell"),this.$dragHandle=this.$(".resize-handle")},templateHelpers:function(){return{colWidth:_.bind(function(){var e=this.model.get("meta").get("grid");return e.get("colWidth")},this),baseWidth:_.bind(function(){var e=this.model.get("meta").get("grid");return e.get("baseWidth")},this)}},selectedChanged:function(e,t){this.$el.toggleClass("cell--selected",t)},initialize:function(){this.$doc=t(document),this.listenTo(this.model.get("meta").get("grid"),"change:colWidth",this.render,this),this.listenTo(this.model.get("meta").get("grid"),"change:baseWidth",this.render,this)},onMouseDown:function(e){e.currentTarget===this.$dragHandle[0]&&(e.preventDefault(),this.baseWidth=this._parent.$childViewContainer.width(),this.baseColWidth=this.baseWidth/this.model.get("meta").get("grid").get("baseWidth"),this.startX=e.pageX,this.$doc.on("mousemove",_.bind(this.onMouseMove,this)),this.$doc.on("mouseup",_.bind(this.onMouseUp,this)),t("body").addClass("cursor-force--col-resize"),this.$dragHandle.addClass("hover"))},onMouseMove:function(e){this.isDragging||(this.isDragging=!0);var t=-(this.startX-e.pageX),i=t/this.baseColWidth,o=this.model.collection.at(this.model.collection.indexOf(this.model)-1);if(-1>=i){var a=o.getColWidth()-1;a>=1&&(o.setColWidth(o.getColWidth()-1),this.model.setColWidth(this.model.getColWidth()+1),this.startX=e.pageX)}if(i>=1){var s=this.model.getColWidth()-1;s>=1&&(o.setColWidth(o.getColWidth()+1),this.model.setColWidth(this.model.getColWidth()-1),this.startX=e.pageX)}},onMouseUp:function(e){this.$dragHandle.removeClass("hover"),t("body").removeClass("cursor-force--col-resize"),this.$doc.off("mousemove"),this.$doc.off("mouseup"),this.isDragging&&(e.preventDefault(),this.isDragging=!1)},removeCell:function(e){e.preventDefault(),e.stopPropagation(),this.triggerMethod("delete:cell",this.model)},selectCell:function(){this.triggerMethod("select:cell",this.model.cid)}});return o}),define("wasabi.cms.package/components/row-dialog/views/RowEditor",["require","marionette","wasabi.cms.package/components/row-dialog/views/CellEditor"],function(e){var t=e("marionette"),i=e("wasabi.cms.package/components/row-dialog/views/CellEditor"),o=t.CompositeView.extend({tagName:"div",className:"row-editor",childView:i,childViewContainer:".cells",template:"#pb-row-editor",childEvents:{"select:cell":"selectCell","delete:cell":"deleteCell"},ui:{rowLayoutSelect:"#rowLayoutSelect"},events:{"change @ui.rowLayoutSelect":"updateLayout"},initialize:function(e){this.dialog=e.dialog,this.collection=this.model.cells},onRender:function(){this.$el.attr("data-type","row")},selectCell:function(e,t){this.collection.each(function(e){e.cid===t?e.set("selected",!0):e.set("selected",!1)})},deleteCell:function(e,t){var i=this.collection.indexOf(t),o=0>i-1?void 0:this.collection.at(i-1),a=i+1>this.collection.models.length?void 0:this.collection.at(i+1),s="undefined"!=typeof o,n="undefined"!=typeof a;(s||n)&&(s?o.get("meta").get("grid").set("colWidth",o.get("meta").get("grid").get("colWidth")+t.get("meta").get("grid").get("colWidth")):a.get("meta").get("grid").set("colWidth",a.get("meta").get("grid").get("colWidth")+t.get("meta").get("grid").get("colWidth")),this.collection.remove(t),this.render())},updateLayout:function(e){var t=$(e.currentTarget),i=t.val();if(""!==i){var o=i.split(":"),a=parseInt(o[0]),s=parseInt(o[1]),n=a/s,l=this.collection.models.length;if(n>l)for(var r=0,c=n-l;c>r;r++)this.model.addCell({meta:{type:"Cell",grid:{colWidth:s,baseWidth:a}},data:[]});l>n&&this.collection.remove(this.collection.slice(n-l)),this.collection.each(function(e){e.setColWidth(s),e.setBaseWidth(a)})}}});return o}),define("wasabi.cms.package/components/row-dialog/models/CellEditor",["require","backbone","wasabi.cms.package/models/Meta"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/models/Meta"),o=t.Model.extend({initialize:function(){return this.set("meta",new i(this.get("meta")),{silent:!0}),this},getColWidth:function(){return this.get("meta").get("grid").get("colWidth")},setColWidth:function(e){this.get("meta").get("grid").set("colWidth",e)},getBaseWidth:function(){return this.get("meta").get("grid").get("baseWidth")},setBaseWidth:function(e){this.get("meta").get("grid").set("baseWidth",e)},getData:function(){return{meta:this.get("meta").getData(),data:[]}}});return o}),define("wasabi.cms.package/components/row-dialog/collections/EditorCells",["require","backbone","wasabi.cms.package/components/row-dialog/models/CellEditor"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/components/row-dialog/models/CellEditor"),o=t.Collection.extend({collectionType:"EditorCellsCollection",model:i});return o}),define("wasabi.cms.package/components/row-dialog/models/RowEditor",["require","backbone","wasabi.cms.package/models/Meta","wasabi.cms.package/components/row-dialog/collections/EditorCells","wasabi.cms.package/components/row-dialog/models/CellEditor"],function(e){var t=e("backbone"),i=e("wasabi.cms.package/models/Meta"),o=e("wasabi.cms.package/components/row-dialog/collections/EditorCells"),a=e("wasabi.cms.package/components/row-dialog/models/CellEditor"),s=t.Model.extend({initialize:function(){var e=this.get("data");return e&&(this.cells=new o(e),this.unset("data")),this.set("meta",new i(this.get("meta")),{silent:!0}),this},addCell:function(e){this.cells.add(new a(e))},getData:function(){var e={meta:this.get("meta").getData(),data:[]};return this.cells.each(function(t){e.data.push(t.getData())}),e}});return s}),define("wasabi.cms.package/components/row-dialog/views/RowDialog",["require","jquery","wasabi","common/DialogView","wasabi.cms.package/components/row-dialog/views/RowEditor","wasabi.cms.package/components/row-dialog/models/RowEditor"],function(e){var t=e("jquery"),i=e("wasabi"),o=e("common/DialogView"),a=e("wasabi.cms.package/components/row-dialog/views/RowEditor"),s=e("wasabi.cms.package/components/row-dialog/models/RowEditor"),n=o.extend({events:function(){return _.extend(o.prototype.events,{'click button[type="submit"]':"onSubmit"})},type:"add",rowEditorView:null,initialize:function(e){this.pageBuilder=e.pageBuilder,o.prototype.initialize.call(this,e)},beforeRender:function(){var e=i.get("wasabi.cms").translations.dialog[this.type+"Row"];this.templateData={title:e.title,primaryAction:e.primaryAction}},initDialogContent:function(){var e=new s({meta:{type:"Row"},data:[{meta:{type:"Cell",grid:{colWidth:4,baseWidth:16}},data:[]},{meta:{type:"Cell",grid:{colWidth:4,baseWidth:16}},data:[]},{meta:{type:"Cell",grid:{colWidth:4,baseWidth:16}},data:[]},{meta:{type:"Cell",grid:{colWidth:4,baseWidth:16}},data:[]}]});this.rowEditorView=i.createView(a,{pageBuilder:this.pageBuilder,dialog:this,model:e}),this.rowEditorView.render(),this.$content.html(this.rowEditorView.el)},setType:function(e){return this.type=e,this},onSubmit:function(e){var i=t(e.currentTarget);"disabled"!==i.attr("disabled")&&(i.attr("disabled","disabled"),this.rowEditorView.model.set("data",this.rowEditorView.model.cells.toJSON()),"add"===this.type&&this.pageBuilder.addRow(this.rowEditorView.model.getData()),this.closeDialog())}});return n}),define("wasabi.cms.package/components/module-dialog/views/ModuleDialog",["require","wasabi","common/DialogView"],function(e){var t=e("wasabi"),i=e("common/DialogView"),o=i.extend({initialize:function(e){i.prototype.initialize.call(this,e)},beforeRender:function(){var e=t.get("wasabi.cms").translations.dialog.addModule;this.templateData={title:e.title,primaryAction:e.primaryAction,sidebarLeft:!0}}});return o}),define("wasabi.cms.package/views/DroppableMixin",["require","wasabi"],function(e){var t=e("wasabi"),i={dragOver:function(e,t){if(!t.hitTest(e.pageX,e.pageY,t.$placeholder)){this.$childViewContainer||(this.$childViewContainer=this.$(this.childViewContainer));var i=this.$childViewContainer.find("> div").filter(function(e,t){var i=$(t);return!i.hasClass("placeholder")&&!i.hasClass("dragging")&&"none"!==i.css("display")}),o=null,a=null;i.each(function(){var i=$(this).offset().top-t.$win.scrollTop(),s=i+$(this).outerHeight(),n=e.pageY-t.$win.scrollTop(),l=parseInt((i+s)/2);return l>=n?(o=$(this),a="before",!1):n>l&&s>=n?(o=$(this),a="after",!1):void 0}),null===o&&0===i.length&&(a="append");var s=t.$placeholder.parent();switch(a){case"append":this.$childViewContainer.append(t.$placeholder);break;case"before":o.before(t.$placeholder);break;case"after":o.after(t.$placeholder)}s.trigger("placeholder-moved"),t.$placeholder.parent().trigger("placeholder-moved")}},drop:function(e){var i=e.$placeholder.index()-1,o=this.collection;e._parent.collection.remove(e.model,{silent:!0}),o.add(e.model,{at:i,silent:!0}),e._parent=this,t.Cms.views.pageBuilder.model.rebuildContentData()}};return i}),require(["jquery"],function(e){function t(e,t,i){return[parseFloat(e[0])*(u.test(e[0])?t/100:1),parseFloat(e[1])*(u.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function o(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}var a,s,n=Math.max,l=Math.abs,r=Math.round,c=/left|center|right/,d=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,p=/^\w+/,u=/%$/,g=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==a)return a;var t,i,o=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=o.children()[0];return e("body").append(o),t=s.offsetWidth,o.css("overflow","scroll"),i=s.offsetWidth,t===i&&(i=o[0].clientWidth),o.remove(),a=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),o=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),a="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,s="scroll"===o||"auto"===o&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:a?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),o=e.isWindow(i[0]),a=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:o,isDocument:a,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:o||a?i.width():i.outerWidth(),height:o||a?i.height():i.outerHeight()}}},e.fn.position=function(a){if(!a||!a.of)return g.apply(this,arguments);a=e.extend({},a);var u,m,w,f,b,v,y=e(a.of),C=e.position.getWithinInfo(a.within),k=e.position.getScrollInfo(C),$=(a.collision||"flip").split(" "),D={};return v=o(y),y[0].preventDefault&&(a.at="left top"),m=v.width,w=v.height,f=v.offset,b=e.extend({},f),e.each(["my","at"],function(){var e,t,i=(a[this]||"").split(" ");1===i.length&&(i=c.test(i[0])?i.concat(["center"]):d.test(i[0])?["center"].concat(i):["center","center"]),i[0]=c.test(i[0])?i[0]:"center",i[1]=d.test(i[1])?i[1]:"center",e=h.exec(i[0]),t=h.exec(i[1]),D[this]=[e?e[0]:0,t?t[0]:0],a[this]=[p.exec(i[0])[0],p.exec(i[1])[0]]}),1===$.length&&($[1]=$[0]),"right"===a.at[0]?b.left+=m:"center"===a.at[0]&&(b.left+=m/2),"bottom"===a.at[1]?b.top+=w:"center"===a.at[1]&&(b.top+=w/2),u=t(D.at,m,w),b.left+=u[0],b.top+=u[1],this.each(function(){var o,c,d=e(this),h=d.outerWidth(),p=d.outerHeight(),v=i(this,"marginLeft"),q=i(this,"marginTop"),M=h+v+i(this,"marginRight")+k.width,j=p+q+i(this,"marginBottom")+k.height,W=e.extend({},b),x=t(D.my,d.outerWidth(),d.outerHeight());"right"===a.my[0]?W.left-=h:"center"===a.my[0]&&(W.left-=h/2),"bottom"===a.my[1]?W.top-=p:"center"===a.my[1]&&(W.top-=p/2),W.left+=x[0],W.top+=x[1],s||(W.left=r(W.left),W.top=r(W.top)),o={marginLeft:v,marginTop:q},e.each(["left","top"],function(e,t){g[$[e]]&&g[$[e]][t](W,{targetWidth:m,targetHeight:w,elemWidth:h,elemHeight:p,collisionPosition:o,collisionWidth:M,collisionHeight:j,offset:[u[0]+x[0],u[1]+x[1]],my:a.my,at:a.at,within:C,elem:d})}),a.using&&(c=function(e){var t=f.left-W.left,i=t+m-h,o=f.top-W.top,s=o+w-p,r={target:{element:y,left:f.left,top:f.top,width:m,height:w},element:{element:d,left:W.left,top:W.top,width:h,height:p},horizontal:0>i?"left":t>0?"right":"center",vertical:0>s?"top":o>0?"bottom":"middle"};h>m&&l(t+i)<m&&(r.horizontal="center"),p>w&&l(o+s)<w&&(r.vertical="middle"),r.important=n(l(t),l(i))>n(l(o),l(s))?"horizontal":"vertical",a.using.call(this,e,r)}),d.offset(e.extend(W,{using:c}))})},function(){var t,i,o,a,s,n=document.getElementsByTagName("body")[0],l=document.createElement("div");t=document.createElement(n?"div":"body"),o={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},n&&e.extend(o,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in o)t.style[s]=o[s];t.appendChild(l),i=n||document.documentElement,i.insertBefore(t,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",a=e(l).offset().left;t.innerHTML="",i.removeChild(t)}()}),define("jquery.position",["jquery"],function(){}),define("wasabi.cms.package/views/DraggableMixin",["require","jquery","wasabi","jquery.scrollParent","jquery.position"],function(e){var t=e("jquery"),i=e("wasabi");e("jquery.scrollParent"),e("jquery.position");var o={opacity:.7,scroll:!0,scrollSensitivity:20,scrollSpeed:20,animateTarget:!0,animationLength:300},a={startMouse:{},startPosition:{},mouseStartRelativeToElement:{},offset:{},isDragging:!1,$scrollParent:null,$dragHandle:null,activeDropTargetView:null,initializeDraggable:function(e){this.options=t.extend(o,{},e),this.model.view=this,this.$dragHandle.on("mousedown",_.bind(this.onMouseDown,this)),this.$doc=t(document),this.$win=t(window)},onMouseDown:function(e){e.currentTarget===this.$dragHandle[0]&&(e.preventDefault(),this._initStart(e),this.$doc.on("mousemove",_.bind(this.onMouseMove,this)),this.$doc.on("mouseup",_.bind(this.onMouseUp,this)))},onMouseMove:function(e){this.isDragging||(this._initClone(),this._initPlaceholder(),this.$scrollParent=this.$clone.scrollParent(),this.isDragging=!0),this._updateClonePosition(e),this.options.scroll===!0&&this._scroll(e);var t=i.Cms.views.pageBuilder.droppableViews;if(null!==t){this.activeDropTargetView=null;for(var o=_.filter(t,function(e){return"Cell"===e.viewType}),a=_.filter(t,function(e){return"ContentArea"===e.viewType}),s=0,n=o.length;n>s;s++)if(this.hitTest(e.pageX,e.pageY,o[s].$el)){this.activeDropTargetView=o[s];break}if(null===this.activeDropTargetView)for(s=0,n=a.length;n>s;s++)if(this.hitTest(e.pageX,e.pageY,a[s].$el)){this.activeDropTargetView=a[s];break}}null!==this.activeDropTargetView&&this.activeDropTargetView.canDrop(this)===!0&&"function"==typeof this.activeDropTargetView.dragOver&&this.activeDropTargetView.dragOver(e,this)},onMouseUp:function(e){function t(){i.$el.css("width",""),i.$placeholder.remove(),i.$clone.remove(),i.$el.show(),i.$clone=null,i.options.hideDraggable&&this.getDraggableElement().show(),i.$scrollParent=null,i.isDragging=!1}e.preventDefault();var i=this;this.$doc.off("mousemove"),this.$doc.off("mouseup"),this.isDragging&&(null!==this.activeDropTargetView&&this.activeDropTargetView.canDrop(this)&&(this.$placeholder.before(this.$el),"function"==typeof this.activeDropTargetView.drop&&this.activeDropTargetView.drop(this),this.activeDropTargetView=null),this.options.animateTarget?this.$clone.animate(this._getStopPosition(),parseInt(this.options.animationLength),t):t())},hitTest:function(e,i,o){var a=t(o),s=a.offset(),n=s.left,l=s.top,r=n+a.outerWidth(!0),c=l+a.outerHeight(!0);return e>=n&&r>=e&&i>=l&&c>=i},_initStart:function(e){this.position=this.$el.position(),this.startMouse={x:e.pageX,y:e.pageY},this.mouseStartRelativeToElement={x:this.startMouse.x-this.$el.offset().left,y:this.startMouse.y-this.$el.offset().top},this.offset={x:e.pageX-this.position.left,y:e.pageY-this.position.top},this.startPosition=this._getStartPosition()},_initClone:function(){this.$clone=this.$el.clone(),this.$clone.addClass("dragging"),this.$clone.css({display:"block",width:this.$el.outerWidth(),height:this.$el.outerHeight(),position:"fixed",zIndex:1e4,opacity:this.options.opacity}),this.$el.parent().append(this.$clone),this.$el.hide()},_updateClonePosition:function(e){this.$clone.position({my:"left-"+this.mouseStartRelativeToElement.x+" top-"+this.mouseStartRelativeToElement.y,of:e})},_initPlaceholder:function(){this.$placeholder=this.$el.clone().html("").addClass("placeholder").css({display:"block",height:this.$el.innerHeight()}),this.afterInitPlaceholder(this.$placeholder),this.$el.before(this.$placeholder)},_getStartPosition:function(){return{x:this.offset.x,y:this.offset.y}},_getStopPosition:function(){return{top:this.$placeholder.offset().top-this.$win.scrollTop(),left:this.$placeholder.offset().left-this.$placeholder.css("marginLeft").split("px")[0],width:this.getPlaceholderWidth()}},_scroll:function(e){var t=this.$scrollParent[0],i=this.$scrollParent.offset();if(t!=this.$doc[0]&&"HTML"!=t.tagName)i.top+t.offsetHeight-e.pageY<this.options.scrollSensitivity?t.scrollTop=t.scrollTop+this.options.scrollSpeed:e.pageY-i.top<this.options.scrollSensitivity&&(t.scrollTop=t.scrollTop-this.options.scrollSpeed),i.left+t.offsetWidth-e.pageX<this.options.scrollSensitivity?t.scrollLeft=t.scrollLeft+this.options.scrollSpeed:e.pageX-i.left<this.options.scrollSensitivity&&(t.scrollLeft=t.scrollLeft-this.options.scrollSpeed);else{var o=this.$doc,a=this.$win;e.pageY-o.scrollTop()<this.options.scrollSensitivity?o.scrollTop(o.scrollTop()-this.options.scrollSpeed):a.height()-(e.pageY-o.scrollTop())<this.options.scrollSensitivity&&o.scrollTop(o.scrollTop()+this.options.scrollSpeed),e.pageX-o.scrollLeft()<this.options.scrollSensitivity?o.scrollLeft(o.scrollLeft()-this.options.scrollSpeed):a.width()-(e.pageX-o.scrollLeft())<this.options.scrollSensitivity&&o.scrollLeft(o.scrollLeft()+this.options.scrollSpeed)}}};return a}),define("wasabi.cms.package/components/page-builder/views/Module",["require","underscore","marionette","wasabi.cms.package/views/DraggableMixin"],function(e){var t=(e("underscore"),e("marionette")),i=e("wasabi.cms.package/views/DraggableMixin"),o=t.ItemView.extend({viewType:"Module",template:"#pb-module",events:{changedPosition:"onChangedPosition"},onRender:function(){this.$el.addClass("module"),this.$dragHandle=this.$el,this.initializeDraggable()},templateHelpers:function(){return{title:this.model.get("meta").get("title"),description:this.model.get("meta").get("description")}},afterInitPlaceholder:function(e){e.css("height",parseInt(e.css("height").split("px")[0])+2)},getPlaceholderWidth:function(){return this.$placeholder.outerWidth()},onChangedPosition:function(){console.log("changedPosition",this)}});return o.prototype=$.extend(o.prototype,i),o}),define("wasabi.cms.package/components/page-builder/views/Cell",["require","wasabi","marionette","wasabi.cms.package/views/DroppableMixin","wasabi.cms.package/components/page-builder/views/Module"],function(e){var t=e("wasabi"),i=e("marionette"),o=e("wasabi.cms.package/views/DroppableMixin"),a=e("wasabi.cms.package/components/page-builder/views/Module"),s=i.CompositeView.extend({viewType:"Cell",template:"#pb-cell",childViewContainer:".cell-wrapper",childView:a,events:{"click .cell-wrapper":"selectCell","placeholder-moved":"onPlaceholderMoved"},modelEvents:{"change:selected":"onChangeSelectedState"},initialize:function(){this.collection=this.model.modules,t.Cms.views.pageBuilder.droppableViews.push(this)},onRender:function(){var e=this.model.get("meta").get("grid");this.gridClass&&this.$el.removeClass(this.gridClass),this.gridClass="grid-"+e.get("colWidth")+"-"+e.get("baseWidth"),this.$el.addClass(this.gridClass),this.$el.attr("data-type","cell"),this.$dragHandle=this.$(".resize-handle")},selectCell:function(){t.Cms.views.pageBuilder.selectElement(this)},onChangeSelectedState:function(e,t){this.$el.toggleClass("cell--selected",t)},onPlaceholderMoved:function(e){this._parent.syncCellHeight(e)},canDrop:function(e){return"undefined"==typeof e.viewType?!1:"Module"===e.viewType}});return s.prototype=$.extend(s.prototype,o),s}),define("wasabi.cms.package/components/page-builder/views/Row",["require","jquery","wasabi","marionette","wasabi.cms.package/views/DraggableMixin","wasabi.cms.package/components/page-builder/views/Cell"],function(e){var t=e("jquery"),i=e("wasabi"),o=e("marionette"),a=e("wasabi.cms.package/views/DraggableMixin"),s=e("wasabi.cms.package/components/page-builder/views/Cell"),n=o.CompositeView.extend({viewType:"Row",template:"#pb-row",childViewContainer:".cells",childView:s,events:{"click .delete-row":"onDeleteRow"},collectionEvents:{add:"syncCellHeight",remove:"syncCellHeight",change:"syncCellHeight"},initialize:function(){this.collection=this.model.cells},onRender:function(){this.$el.attr("data-type","row"),this.$dragHandle=this.$(".row-sort"),this.initializeDraggable()},afterInitPlaceholder:function(e){e.css("minHeight",e.css("height").split("px")[0]-this.$el.css("marginBottom").split("px")[0]+1)},getPlaceholderWidth:function(){return this.$placeholder.outerWidth()+20},syncCellHeight:function(){var e=0;this.$childViewContainer.find(".cell-wrapper").css("minHeight","").each(function(i,o){e=Math.max(e,t(o).outerHeight())}).css("minHeight",e)},onDeleteRow:function(){this._parent.collection.remove(this.model),i.Cms.views.pageBuilder.model.rebuildContentData()}});return n.prototype=t.extend(n.prototype,a),n}),define("wasabi.cms.package/components/page-builder/views/ContentArea",["require","jquery","wasabi","marionette","wasabi.cms.package/views/DroppableMixin","wasabi.cms.package/components/page-builder/views/Row","wasabi.cms.package/components/page-builder/views/Module"],function(e){var t=e("jquery"),i=e("wasabi"),o=e("marionette"),a=e("wasabi.cms.package/views/DroppableMixin"),s=e("wasabi.cms.package/components/page-builder/views/Row"),n=e("wasabi.cms.package/components/page-builder/views/Module"),l=o.CompositeView.extend({viewType:"ContentArea",template:"#pb-content-area",childViewContainer:".ca-content",ui:{header:".ca-header",contentArea:".content-area"},events:{"click @ui.header":"selectContentArea"},modelEvents:{"change:selected":"onChangeSelectedState"},initialize:function(){this.collection=this.model.content,i.Cms.views.pageBuilder.droppableViews.push(this)},onRender:function(){var e=this.model.get("meta").get("grid");this.gridClass&&this.$el.removeClass(this.gridClass),this.gridClass="grid-"+e.get("colWidth")+"-"+e.get("baseWidth"),this.$el.addClass(this.gridClass)},templateHelpers:function(){return{contentAreaId:this.model.get("meta").get("contentAreaId"),name:this.model.get("meta").get("name")}},buildChildView:function(e){var t=null,i=e.get("meta").get("type");switch(i){case"Row":t=new s({model:e});break;case"Module":t=new n({model:e})}return t},selectContentArea:function(){i.Cms.views.pageBuilder.selectElement(this)},onChangeSelectedState:function(e,t){this.ui.contentArea.toggleClass("content-area--selected",t)},canDrop:function(e){return"undefined"==typeof e.viewType?!1:"Row"===e.viewType||"Module"===e.viewType}});return l.prototype=t.extend(l.prototype,a),l}),define("wasabi.cms.package/components/page-builder/views/PageBuilder",["require","jquery","underscore","wasabi","marionette","wasabi.cms.package/components/row-dialog/views/RowDialog","wasabi.cms.package/components/module-dialog/views/ModuleDialog","wasabi.cms.package/components/page-builder/views/ContentArea"],function(e){var t=e("jquery"),i=(e("underscore"),e("wasabi")),o=e("marionette"),a=e("wasabi.cms.package/components/row-dialog/views/RowDialog"),s=e("wasabi.cms.package/components/module-dialog/views/ModuleDialog"),n=e("wasabi.cms.package/components/page-builder/views/ContentArea"),l=o.CompositeView.extend({template:"#pb-page-builder",childView:n,childViewContainer:".page-builder-content",dialogs:{},$hiddenDataField:null,droppableViews:[],events:{'click [data-add="module"]':"showAddModuleDialog",'click [data-add="row"]':"showAddRowDialog"},modelEvents:{"change:data":"updateHiddenDataField"},initialize:function(e){this.dialogs={module:i.createView(s,{pageBuilder:this}),row:i.createView(a,{pageBuilder:this})},this.$hiddenDataField=e.$hiddenDataField,this.collection=this.model.contentAreas
},onRender:function(){this.$el.addClass("page-builder"),this.eventBus.trigger("pb-page-builder-rendered",this)},setDataField:function(e){this.$hiddenDataField=t(e);var i=this.$hiddenDataField.val();if(""!==i){var o={};try{o=JSON.parse(i)}catch(a){o={}}this.model.loadFormData(o)}return this},showAddModuleDialog:function(){this.dialogs.module.render()},showAddRowDialog:function(){this.dialogs.row.setType("add").render()},selectElement:function(e){var t=this.model.get("selected");t!==e&&("undefined"!=typeof t&&t.model.set("selected",!1),e.model.set("selected",!0),this.model.set("selected",e))},updateHiddenDataField:function(e,t){this.$hiddenDataField.val(JSON.stringify({content:t}))},addRow:function(e){var t=this.model.get("selected");t||(t=this.children.last()),"ContentArea"===t.viewType?t.collection.addRow(e):"Cell"===t.viewType&&t._parent._parent.collection.addRow(e),this.model.rebuildContentData()}});return l}),define("wasabi.cms",["require","jquery","underscore","wasabi","wasabi.cms.package/views/Routes","wasabi.cms.package/components/page-builder/models/PageBuilder","wasabi.cms.package/components/page-builder/views/PageBuilder"],function(e){function t(){s.Cms.views.routes=s.createView(n)}function i(){var e=o("input.page-content"),t=e.val(),i=new l(""!==t?JSON.parse(e.val()):{});s.Cms.views.pageBuilder=s.createView(r,{model:i,$hiddenDataField:e}),s.eventBus.on("pb-page-builder-rendered",function(){o(".page-builder-loader").fadeOut(200,function(){o(".page-builder-wrapper").html(s.Cms.views.pageBuilder.el)})}),s.Cms.views.pageBuilder.render()}var o=e("jquery"),a=e("underscore"),s=e("wasabi"),n=e("wasabi.cms.package/views/Routes"),l=e("wasabi.cms.package/components/page-builder/models/PageBuilder"),r=e("wasabi.cms.package/components/page-builder/views/PageBuilder");return{initialize:function(e){a.extend(this,e),s.Cms={collections:{},models:{},views:{}};var n=o("body");(n.hasClass("wasabi-cms--pages-add")||n.hasClass("wasabi-cms--pages-edit"))&&(t(),i())}}}),require.config({config:{moment:{noGlobal:!0}},paths:{backbone:"../../../../Core/src/Assets/js/vendor/backbone/backbone",marionette:"../../../../Core/src/Assets/js/vendor/marionette/lib/backbone.marionette",jquery:"../../../../Core/src/Assets/js/vendor/jquery/dist/jquery",purl:"../../../../Core/src/Assets/js/vendor/purl/purl",underscore:"../../../../Core/src/Assets/js/vendor/underscore/underscore","jquery.color":"../../../../Core/src/Assets/js/vendor/jquery-color/jquery.color","jquery.eventMagic":"../../../../Core/src/Assets/js/common/jquery-plugins/jquery.eventMagic","jquery.scrollParent":"../../../../Core/src/Assets/js/common/jquery-plugins/jquery.scrollParent","jquery.livequery":"../../../../Core/src/Assets/js/common/jquery-plugins/jquery.livequery","jquery.nSortable":"../../../../Core/src/Assets/js/common/jquery-plugins/jquery.nSortable","jquery.tSortable":"../../../../Core/src/Assets/js/common/jquery-plugins/jquery.tSortable","jquery.position":"../../../../Core/src/Assets/js/common/jquery-plugins/jquery.position","bootstrap.collapse":"../../../../Core/src/Assets/js/vendor/bootstrap/js/collapse","bootstrap.dropdown":"../../../../Core/src/Assets/js/vendor/bootstrap/js/dropdown","bootstrap.transition":"../../../../Core/src/Assets/js/vendor/bootstrap/js/transition",wasabi:"../../../../Core/src/Assets/js/wasabi","wasabi.cms":"./cms","wasabi.cms.package":"./","common/BaseView":"../../../../Core/src/Assets/js/common/BaseView","common/DialogView":"../../../../Core/src/Assets/js/common/DialogView","common/BaseViewFactory":"../../../../Core/src/Assets/js/common/BaseViewFactory"},shim:{backbone:["underscore","jquery"],marionette:["backbone"],"bootstrap.dropdown":["jquery"],"bootstrap.collapse":["jquery","bootstrap.transition"],"jquery.tooltipster":["jquery"],"jquery.color":["jquery"],"jquery.livequery":["jquery"],"jquery.resize":["jquery"],"jquery.perfectScrollbar":["jquery"],"jquery.nSortable":["jquery"],"jquery.tSortable":["jquery"],"jquery.position":["jquery"]}}),define("common",function(){});